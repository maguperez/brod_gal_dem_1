{% extends 'empresa/base.html' %}
{% load staticfiles %}
{%block css%}

<link rel="stylesheet" href="https://cdn.datatables.net/s/bs/dt-1.10.10/datatables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/select/1.1.0/css/select.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.0.0/css/responsive.dataTables.min.css">
<script src="{% static 'js/mixpanel_data_export.js' %}"></script>
<script src="{% static 'js/moment.js' %}"></script>
<script src="{% static 'js/moment-with-locales.js' %}"></script>
<style>
    .menu { cursor: pointer }
    .ocultar {
        display: none;
    }
</style>
{%endblock%}

{% block content %}

<section class="oportunidad-empresa">
    <div class="centered">
        <div>
            <ol class="breadcrumb">
                <li>{{oportunidad.titulo}}</li>
            </ol>
            <ol class="proceso">
                <li data-info="1" {%if oportunidad.fase.id == 1%} class="active" {%endif%}>Postulaci&oacute;n</li>
                <li data-info="2" {%if oportunidad.fase.id == 2%} class="active" {%endif%}>Entrevista Grupal</li>
                <li data-info="3" {%if oportunidad.fase.id == 3%} class="active" {%endif%}>Entrevista Personal</li>
                <li data-info="4" {%if oportunidad.fase.id == 4%} class="active" {%endif%}>Contrataci&oacute;n</li>
            </ol>
            <div class="clear"></div>
        </div>
        <div class="box header">
            <img class="imagen" src="{{empresa.set_logo}}"/>

            <div class="descripcion">
                <a href="{%url 'oportunidad' oportunidad.id%}"><h2 class="link">{{oportunidad.titulo}}</h2></a>

                <div class="empresa"><i class="empresa"></i><label class="text-uppercase">{{empresa.nombre}}</label></div>
                <div class="redes"><i class="social"></i>
                    <script>
                        window.fbAsyncInit = function(){
                        FB.init({
                            appId: '1203258749688742', status: true, cookie: true, xfbml: true });
                        };
                        (function(d, debug){var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
                            if(d.getElementById(id)) {return;}
                            js = d.createElement('script'); js.id = id;
                            js.async = true;js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
                            ref.parentNode.insertBefore(js, ref);}(document, /*debug*/ false));
                        function postToFeed(title, desc, url, image){

                            var obj = {method: 'feed',link: url, picture: '{{ request.get_host }}'+image,name: title,description: desc};
                            function callback(response){}
                            FB.ui(obj, callback);
                        }
                        $(function() {
                            $('.fb-share').click(function () {
                                elem = $(this);
                                postToFeed(elem.data('title'), elem.data('desc'), elem.prop('href'), elem.data('image'));

                                return false;
                            });
                            $('.tt-share').click(function () {
                                 var width  = 575,
                                    height = 400,
                                    left   = ($(window).width()  - width)  / 2,
                                    top    = ($(window).height() - height) / 2,
                                    url    = this.href,
                                    opts   = 'status=1' +
                                             ',width='  + width  +
                                             ',height=' + height +
                                             ',top='    + top    +
                                             ',left='   + left;

                                window.open(url, 'twitter', opts);

                                return false;
                            });
                        });
                    </script>
                    <!--{{ request.build_absolute_uri }}{{ object.get_absolute_url }}-->
                    <a href="someurl.com/some-article"
                       data-image="{{empresa.set_logo}}"
                       data-title="{{oportunidad.titulo}}"
                       data-desc="Oportunidad de empleo disponible en {{empresa.nombre}}" class="fb-share"><i class="facebook"></i></a>

                    <a href="https://twitter.com/share?url={{ request.build_absolute_uri }}&via=twitterdev&related=twitterapi%2Ctwitter&hashtags=example%2Cdemo&text= Oportunidad de empleo disponible en {{empresa.nombre}}"
                        class = "tt-share"><i class="twitter"></i></a>
                </div>
            </div>
            <div class="opciones" onclick="opciones();">
                <i class="menu"></i>
                <div class="contextual-menu" id="menu-oportunidad">
                    <div class="wrapper">
                        <div class="pin"></div>
                        <ul>
                            <li><a href="{%url 'oportunidad-editar' oportunidad.id%}"><span>Editar</span>

                                <div class="clear"></div>
                            </a></li>
                            <li><a href="{%url 'oportunidad' oportunidad.id%}"><span>Visualizar</span>

                                <div class="clear"></div>
                            </a></li>
                            <li><a class="archivar"><span>Archivar</span>

                                <div class="clear"></div>
                            </a></li>
                            </ul>
                    </div>
                </div>
            </div>
            <div class="estado">
                {%if oportunidad.estado_oportunidad == 'P' %}
                    <label>oportunidad archivada</label>
                {%endif%}
                {%if oportunidad.estado_oportunidad == 'A' %}
                    <label style = "background: #16a085">postulacion abierta</label>
                {%endif%}
                {%if oportunidad.estado_oportunidad == 'C' %}
                    <label style = "background: #c0392b">postulacion cerrada</label>
                {%endif%}
                <label>CIERRA EL {{oportunidad.fecha_cese | date:"j.m.Y"}}</label>
            </div>
            <div class="clear"></div>
        </div>
        <div class="box candidatos">
            <div class="content">
                <section>
                    <h2>Administrar Candidatos</h2>

                    <div class="estadistica">
                        <label class="cifra">{{postulaciones}}</label>
                        <label class="nombre">Inscripciones</label>
                    </div>
                    <div class="estadistica">
                        <label id = "visualizaciones" class="cifra"></label>
                        <label class="nombre">Visualizaciones</label>
                    </div>
                    <div class="clear"></div>
                </section>
                <section>
                    <div class="opciones">
                        <input type="checkbox" id="marcar-todos"/><label for="marcar-todos">Marcar todos</label>
                        <a class="btn-option" id="eliminar"><i class="delete"></i>Eliminar</a>
                        <a class="btn-option" id="siguiente-fase"><i class="next"></i>Siguiente fase</a>
                        <a class="btn-option" id="abrir-mensaje" href="#mensaje"><i class="message"></i>Mensaje</a>
                    </div>
                    <table id="tb_candidatos" class="table table-striped table-bordered responsive" data-info="P">
                        <thead>
                        <tr>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th class="align-left">Candidatos</th>
                            <th>Universidad<a></a></th>
                            <th>Carrera</th>
                            <th>Graduaci&oacute;n</th>
                            <th>Inscripci&oacute;n</th>
                            <th>Compatibilidad</th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tr>
                        </thead>

                    </table>
                </section>
            </div>
        </div>
    </div>
</section>

<div class="popup mensaje-edit" id="mensaje">
    <div class="popup-box">
        <div class="content">
            <section class="header">
                <h3>Mensaje</h3>
                <a id="enviar-mensaje" class="btn-action">ENVIAR</a>
                <div class="clear"></div>
            </section>
            <section>
                <div class="destinatarios">
                    <label>Para:</label>
                    <ul>
                    </ul>
                    <div class="clear"></div>
                </div>
                <textarea id="contenido-mensaje" placeholder="Redacte su mensaje"></textarea>
                <div class="permite-respuesta">
                    <input type="checkbox" id="permite-respuesta"/>
                    <label for="permite-respuesta">Permitir respuesta </label><a>(<span class="orange">?</span>)</a>
                </div>
            </section>
        </div>
        <a class="close">Cerrar</a>
    </div>
</div>

<div class="modal fade" id="archivar-modal" >
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h3 class="modal-title"><strong>Archivar Oportunidad</strong></h3>
                    </div>
             <div id="archivar-modal-body" class="modal-body">
				<p>Al archivar la Oportunidad todas las postulaciones relacionadas serán
					finalizadas.</p>

			</div>
            <div class="modal-footer">
				<button type="button" class="btn btn-default btn-archivar" id="btn_archivar">Aceptar</button>
				<button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->

{%csrf_token%}
<div id="form-modal" class="modal fade">
	<div class="modal-dialog">
		<div class="modal-content box">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h2 class="modal-title bold">Modal title</h2>
			</div>
            <div id="form-modal-body" class="modal-body">
				<p>One fine body&hellip;</p>
			</div>
            <!--<div class="modal-footer">-->
				<!--<input type="submit" class="btn btn-primary btn-submit" value ="Guardar" id="modal-aceptar">-->
				<!--<button type="button" class="btn btn-default" data-dismiss="modal" id="modal-cerrar">Cerrar</button>-->
			<!--</div>-->
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<input type="hidden" id="fase" value="{{oportunidad.fase.id}}">
<input type="hidden" id="fase-activa" value="{{oportunidad.fase.id}}">
<input type="hidden" id="f-postulados" value="1">
<input type="hidden" id="f-grupal" value="2">
<input type="hidden" id="f-personal" value="3">
<input type="hidden" id="f-contratacion" value="4">
<input type="hidden" id="id_estudiante">
{% endblock %}

{% block js %}
<script type="text/javascript" src="https://cdn.datatables.net/1.10.10/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.10.10/js/dataTables.bootstrap.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/select/1.1.0/js/dataTables.select.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/responsive/2.0.0/js/dataTables.responsive.min.js"></script>

<script>
    var iniciado = false;
    var selected;

    var seleccionados = [];

    var estadoMarcaTodos = [];

    $(function(){

        $.ajax({
            data : {'id':'{{oportunidad.id}}'},
            url: '{%url "contador-visitas-oportunidad-obtener" %}',
            type: 'get',
            success: function(data){
            $("#visualizaciones").html(data["total"]);
            }
        });

        $('.archivar').click(function(){
			$('.btn-archivar').data('id', $(this).data('id'));
			$("#archivar-modal-body").html('<p>Al archivar la Oportunidad todas las postulaciones' +
					                       ' relacionadas serán finalizadas</p>');
			$('.btn-archivar').show();
        	$('#archivar-modal').modal('toggle');

		});
		$('.btn-archivar').click(function(){
        	$.get("{% url 'oportunidad-archivar' %}?id=" + $(this).data('id'), function(data){
				$("#archivar-modal-body").html('<p>'+data+'</p>');
				$('.btn-archivar').hide();
                $('.estado label').html('oportunidad archivada');
			});
		});

        $('#marcar-todos').change(function(){
            var check = $(this).is(':checked');
            var tabla = $('#tb_candidatos').DataTable();
            var checkboxes = $('#tb_candidatos tbody tr input:checkbox');

            _.forEach(checkboxes,function(value, key){
                    value.checked = check;
                });

            var datos = tabla.rows().data();

            var pagina = tabla.page();

            if(check){
                _.forEach(datos,function(value, key){
                    var objeto = {id_estudiante: value.id_estudiante, pag:pagina, id:value.id};

                    seleccionados =  _.filter(seleccionados, function(ele) {
                        return !(ele.id_estudiante == objeto.id_estudiante && ele.pag==objeto.pag);
                    });

                    seleccionados.push(objeto);
                });
            }
            else{
                //Eliminar todos los elementos que tengo la pagina
               seleccionados =  _.filter(seleccionados, function(ele) {
                    return !(ele.pag==pagina);
                });

            }

            var estadoObjeto = {pag:pagina, estado:check};

            if(estadoMarcaTodos.length > 0){
                var objEncontrado = _.find(estadoMarcaTodos, { pag: pagina});
                if(objEncontrado){
                    estadoMarcaTodos =  _.filter(estadoMarcaTodos, function(ele) {
                        return !(ele.pag==pagina);
                    });

                }
            }
            estadoMarcaTodos.push(estadoObjeto);

        });

    })
    var JSCandidatos = function () {
            this.inicializar = function(){

                $("#tb_candidatos").on("click", ".cargar-cv", function () {
                    id = $(this).parent().data("info");
     	            $('#form-modal-body').load('cv/'+id, function () {
        	            $('#form-modal').modal('toggle');
                        formAjaxSubmit('#form-modal-body form', '#form-modal');
		            });
                });
                $("#tb_candidatos").on("click", ".eliminar", function () {
                    id = new Array();
                    id[0] = $(this).parent().data("id");
                    id_estudiante = new Array();
                    id_estudiante[0] = $(this).parent().data("info");
                    $("#fase-activa").val($("#fase").val());
                    $("#fase").val(0);
                    fnCambioFase(id, id_estudiante);
                });
                $("#tb_candidatos").on("click", ".activar", function () {
                    id = new Array();
                    id[0] = $(this).parent().data("id");
                    id_estudiante = new Array();
                    id_estudiante[0] = $(this).parent().data("info");
                    $("#fase-activa").val($("#fase").val());
                    $("#fase").val(-1);
                    fnCambioFase(id, id_estudiante);
                });
                $("#tb_candidatos").on("click", ".siguiente_fase", function () {
                    id = new Array();
                    id[0] = $(this).parent().data("id");
                    id_estudiante = new Array();
                    id_estudiante[0] = $(this).parent().data("info");
                    $("#fase-activa").val($("#fase").val());
                    $("#fase").val(parseInt($(".proceso .active").data("info")) + 1);
                    fnCambioFase(id, id_estudiante);
                });
                $("#tb_candidatos").on("click", ".mensaje", function () {
                    $("#tb_candidatos").find('input:checkbox').prop( "checked", false );
                    $(this).closest('tr').prev().find('input:checkbox').prop( "checked", true );
                    $(".destinatarios ul").html('<li><label class="nombre">'+ $(this).closest('tr').prev().find('td:nth-child(4)').html() +'</label></li>');
                });
            };
            this.obtener = function(){
               return $('#tb_candidatos').dataTable({
                    responsive: {
                        details: {
                            type: 'control',
                            target: 9
                        }
                    },
                    destroy: true,
                    searching: false,
                    language: {
                        url: "{%static 'js/dataTable-i18n/es-ES.json' %}"
                    },
                    columnDefs: [
                        {sortable: false, targets: [0, 9, 8]},
                        {searchable: false, targets: [0, 9, 8]},
                        {class: "all", targets: [0, 3, 5, 6, 7, 8, 9]},
                        {class: "none", targets: [10]},
                        {class: "never", targets: [1,2,11,12]},
                        {
                            targets: 0,
                            className: 'dt-body-center',
                            render: function (data, type, full, meta) {
                                if(full.estado_fase == 'A') {
                                    return '<input class = "checking" type="checkbox"' +"data-info='" + full.id_estudiante +
                                            "' data-id='" + full.id + "'" +
                                            (selected != null && selected[full.id] != null ? "checked" : "") + '>';
                                } else return '';
                            }
                        },
                        {
                            targets: 9,
                            className: 'dt-expandir',
                            render: function (data, type, full, meta) {
                                return '<i class="menu"></i>';
                            }
                        },
                        {
                            targets: 10,
                            render: function (data, type, full, meta) {
                                var html =  '<div class="" data-id="' + full["id"] + '" data-info="' + full["id_estudiante"] + '">';
                                if(full.estado_fase == 'A'){
                                    html += '<a class="btn-option eliminar"><i class="delete"></i>Eliminar</a>' +
                                            '<a class="btn-option siguiente_fase"><i class="next"></i>Siguiente fase</a>';
                                }
                                else{
                                    html += '<a class="btn-option fa fa-check activar"><i class="activar"></i>Activar</a>';
                                }
                                html += '<a class="btn-option mensaje" href="#mensaje"><i class="message"></i>Mensaje</a>' +
                                        '<a class="btn-option cargar-cv"><i class="curriculum"></i>Ver CV</a>' +
                                        '</div>';
                                return html;
                            }
                        },
                        {
                            targets: 3,
                            className: 'nombre-candidato',
                        }
                    ],
                    filter: false,
                    serverSide: true,
                    processing: true,
                    lengthChange: false,
                    iDisplayLength: 10,
                    stateSave: true,
                    stateSaveCallback: function (settings, data) {
//                debugger;
                    },
                     ajax: {
                        type: "GET",
                        url: "{% url 'candidatos' %}",
                        data: function (d) {
                            d.id = "{{oportunidad.id}}";
                            d.f = $("#fase").val();
                        }
                    },
                    columns: [
                        {data: "checkbox", class:"check-row"},
                        {data: "id"},
                        {data: "id_estudiante"},
                        {data: "nombre"},
                        {data: "universidad"},
                        {data: "carrera"},
                        {data: "graduacion"},
                        {data: "fecha_postulacion"},
                        {data: "compatibilidad"},
                        {data: "botones"},
                        {data: "botones"},
                        {data: "estado"},
                        {data: "estado_fase"},
                    ],
                });
            }
        }
    var CandidatosTable = new JSCandidatos();
    var formAjaxSubmit = function(form, modal) {
	    $(form).submit(function (e) {
		    e.preventDefault();
            $.ajax({
			    type: $(this).attr('method'),
				url: $(this).attr('action'),
				data: $(this).serialize(),
				    success: function (xhr, ajaxOptions, thrownError) {
					    if ($(xhr).find('.has-error').length > 0) {
						    $(modal).find('.modal-body').html(xhr);
							 formAjaxSubmit(form, modal);
                        } else {
						    $(modal).modal('toggle');
                             window.location.reload();
						 }
					},
                    error: function (xhr, ajaxOptions, thrownError) { }
                });
            });
	    }

    $(document).ready(function () {
        var table = CandidatosTable.obtener();
        if (!iniciado) {
           iniciado = true;
           CandidatosTable.inicializar();
        }
        $("#tb_candidatos").on("change",".checking", function() {
           selected = new Array();
           var data = table.api().row($(this).parents('tr')).data();

           if ($(this).is(":checked")){
               selected[data.id] = data;
           }
           else if (selected[data.id] != null) {
               selected[data.id] = null;
           }

           if(!$(this).is(":checked") && $('#marcar-todos').is(":checked")){
               var tabla = $('#tb_candidatos').DataTable();
               var pagina = tabla.page();

               $('#marcar-todos')[0].checked = false;

               var estadoObjeto = {pag:pagina, estado:false};

                if(estadoMarcaTodos.length > 0){
                    var objEncontrado = _.find(estadoMarcaTodos, { pag: pagina});
                    if(objEncontrado){
                        estadoMarcaTodos =  _.filter(estadoMarcaTodos, function(ele) {
                            return !(ele.pag==pagina);
                        });

                    }
                }
                estadoMarcaTodos.push(estadoObjeto);
           }

            var check = $(this).is(":checked");
            var id_estudiante = data.id_estudiante;
            var id = data.id;



            actualizarSeleccionadosPorFila(id_estudiante,check,id);
       });

        $('#tb_candidatos').on( 'draw.dt', function () {
            $('#marcar-todos')[0].checked = false;

            var tabla = $(this).DataTable();

            var pagina = tabla.page();

            var datos = tabla.rows().data();

            if(datos.length){

                var elementos = $('#tb_candidatos tbody tr');//seleccionar TRs


                //si en el TR el id existe dentro de el arreglo de seleccionados
                //colocar check
                for(var i=0;i<elementos.length;i++){

                    //selecciona id del estudiante dentro del tr
                    var id_estudiante = $(elementos[i])[0].cells[2].innerHTML;


                    var candidatos =  _.filter(seleccionados, function(ele) {
                        return (ele.id_estudiante == id_estudiante && ele.pag == pagina);
                    });

                    //selecciona el TD donde esta el checkbox
                    var e = $(elementos[i])[0].cells[0];

                    var booleanExistencia = candidatos.length > 0;

                    $(e)[0].firstChild.checked = booleanExistencia;

                }

                if(estadoMarcaTodos.length > 0){
                    var objEncontrado = _.find(estadoMarcaTodos, { pag: pagina});
                    if(objEncontrado){
                        $('#marcar-todos')[0].checked = objEncontrado.estado;
                    }

                }

            }

        } );

        $('#siguiente-fase').click(function (event) {
{#            ids = new Array();#}
{#            $("input:checked", table.fnGetNodes()).each(function(index, value){#}
{#                ids[index] = $(this).data("id");#}
{#            });#}
{##}
{#            ids_estudiante = new Array();#}
{#            $("input:checked", table.fnGetNodes()).each(function(index, value){#}
{#                ids_estudiante[index] = $(this).data("info");#}
{#            });#}

            var ids = [];
            var ids_estudiante = [];

            _.forEach(seleccionados,function(value){
                ids.push(value.id);
                ids_estudiante.push(value.id_estudiante);
            });

            $("#fase").val( parseInt($(".proceso .active").data("info")) + 1);
            fnCambioFase(ids, ids_estudiante);
        });

        $('#eliminar').click(function (event) {
            ids = new Array();
            $("input:checked", table.fnGetNodes()).each(function(index, value){
                ids[index] = $(this).data("id");
            });
            ids_estudiante = new Array();
            $("input:checked", table.fnGetNodes()).each(function(index, value){
                ids_estudiante[index] = $(this).data("info");
            });
            $("#fase-activa").val($("#fase").val());
            $("#fase").val(0);
            fnCambioFase(ids, ids_estudiante);

        });

        $('.proceso li').click(function (event) {
//             $('.proceso li').each(function(){
//               if ($(this).hasClass('active'))
//			        $(this).removeClass('active');
//             });
             element_ant = $('.proceso .active');
             $(element_ant).removeClass('active');
             $(this).addClass('active');
             $("#fase").val($(this).data("info"));
             CandidatosTable.obtener();
        });
        $("table").on("click",".btn-option.mensaje", function(){
            $("#contenido-mensaje").val('');
        })
        $('#abrir-mensaje').click(function(){
            $(".destinatarios ul").html('');
            $("#contenido-mensaje").val('');
            $("input:checked", table.fnGetNodes()).each(function(index, value){
               $(".destinatarios ul").append('<li><label class="nombre">'+ $(this).parent().parent().find('td:nth-child(4)').html() +'</label></li>');
            });
        });

        $('#enviar-mensaje').click(function(){
            ids = new Array();
            $("input:checked", table.fnGetNodes()).each(function(index, value){
                ids[index] = $(this).data("id");
            });
            ids_estudiante = new Array();
            $("input:checked", table.fnGetNodes()).each(function(index, value){
                ids_estudiante[index] = $(this).data("info");
            });

             var form = new FormData();

             form.append('ids',JSON.stringify(ids));
             form.append('ids_estudiante',JSON.stringify(ids_estudiante));
             form.append('o','{{oportunidad.id}}');
             form.append('a','');
             form.append('c',$('#contenido-mensaje').val());
             form.append('p',$('#permite-respuesta').is(':checked')? 'S' : 'N');
             form.append('csrfmiddlewaretoken',$('[name="csrfmiddlewaretoken"]').val());


             $.ajax({
                 type:"POST",
                 url:"{%url 'mensaje-enviar-estudiante' %}",
                 data: form,
                 processData: false,
                 contentType: false,
                 success: function(x){
                     $('#contenido-mensaje').val("");
                     window.history.back();
                 },
                 error: function(x){
                    console.log(x);
                 }
            });
//            return false;
       });

   });

    function actualizarSeleccionadosPorFila(id_estudiante,check,id){

        var tabla = $('#tb_candidatos').DataTable();
        var pagina = tabla.page();

        var elementos =  _.filter(seleccionados, function(ele) {
            return (ele.id_estudiante == id_estudiante && ele.pag==pagina);
        });

        if(elementos.length > 0){
            if(!check){
                seleccionados =  _.filter(seleccionados, function(ele) {
                    return !(ele.id_estudiante == id_estudiante && ele.pag==pagina);
                });
            }
        }
        else{
            if(check){
                var objeto = {id_estudiante: id_estudiante, pag:pagina, id:id};
                seleccionados.push(objeto);
            }

        }

    }

    function fnCambioFase(ids, ids_estudiante){
        $.ajax({
            url: '{%url "siguiente-fase" %}',
            type: 'GET',
            data: {'ids': JSON.stringify(ids), 'ids_estudiante': JSON.stringify(ids_estudiante), 'f': $("#fase").val(), 'o': '{{oportunidad.id}}'},
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                var fase = $("#fase").val();
                if (fase > 0){
                    element_ant = $('.proceso .active');
			        $(element_ant).removeClass('active');
                    element_actual =  $(".proceso").find("[data-info='"+fase+"']");
                    $(element_actual).addClass('active');
                }
                else{
                    $("#fase").val($("#fase-activa").val());
                }
                CandidatosTable.obtener();
            }
        });
    }


</script>
{%endblock%}