{% extends 'empresa/base.html' %}
{% block content %}
 <section class="oportunidades-empresa">
			<div class="centered">
				<select class="filtro">
					<option value="A">Oportunidades Abiertas</option>
					<option value="C">Oportunidades Cerradas</option>
					<option value="P">Oportunidades Pendientes</option>
				</select>
				<div class="clear"></div>
				<ul class="list" id ="oportunidad-lista">

				</ul>
			</div>
		</section>
		<div id='loading-image'></div>
 {% endblock %}
{% block js%}

<script>
	(function(){
		$("#link-oportunidades").addClass("active");
	  var addOportunidad = function(obj,el) {
		  var op = '';
		  op += '<li class="oportunidad-estadistica">';
		  op += '<div class="box header">';
		  op += '<img class="imagen" src="' +obj.logo+ '" />';
		  op += '<div class="descripcion">';
		  op += '<a href="candidatos_oportunidad.html"><h2 class="link">'+obj.titulo+'</h2></a>';
		  op += '<div class="empresa"><i class="empresa"></i><label>'+obj.empresa+'</label></div>';
		  op += '</div>';
		  op += '<div class="opciones" onclick="opciones('+obj.id+')">';
		  op += '<i class="menu"></i>';
		  op += '<div class="contextual-menu" id="menu-'+obj.id+'">';
		  op += '<div class="wrapper">';
		  op += '<div class="pin"></div>';
		  op += '<ul>';
		  op += '<li><a href=""><span>Editar</span><div class="clear"></div></a></li>';
		  op += '<li><a href="candidatos_oportunidad.html"><span>Ver candidatos</span><div class="clear"></div></a></li>';
		  op += '<li><a href=""><span>Archivar</span><div class="clear"></div></a></li>';
		  op += '<ul></div></div></div>';
		  op += '<div class="estado">';
		  op += '<label>'+'obj.estado'+'</label>';
		  op += '<label>CIERRA EL' + obj.fecha_cese+'</label>';
		  op += '</div><div class="clear"></div></div>';
		  op += '<div class="row"><div class = "col-sm-12">';
		  op += '<div class="visualizaciones"><div class="box"> <div class="estadistica"> <div class="cifra">';
		  op += '<label>792</label>';
		  op += '<label>Visualizaciones</label>';
		  op += '</div>';
		  op += '<div class="grafico grafico-barras">';
		  op +=	'<img src="/static/img/estadisticas-barras.jpg" />';
		  op += '</div>';
		  op += '<div class="clear"></div>';
		  op += '</div>';
		  op += '<div class="estadistica">';
		  op += '<div class="cifra">';
		  op += '<label>101</label>';
		  op += '<label>Inscripciones</label>';
		  op += '</div>';
		  op += '<div class="grafico usuarios">';
		  op += '<img src="/static/img/profile/profile.png" />';
		  op += '<div class="clear"></div>';
		  op += '</div>';
		  op += '<div class="clear"></div>';
		  op += '</div></div></div>';
		  op += '<div class="inscripciones">';
		  op += '<div class="box">';
		  op += '<label class="titulo">Inscripciones en los &uacute;ltimos 7 d&iacute;as</label>';
		  op += '<div class="grafico grafico-inscripciones">';
		  op += '<img src="/static/img/estadisticas-inscripciones.jpg" />';
		  op += '</div></div></div><div class="clear"></div></div></div></li>';

		  $(el).html(op);

	  };

	  //https://dannyvankooten.com/delay-scroll-handlers-javascript/
	  var content = true;
	  var timer;
	  if (content) {
		$(window).scroll(function() {
		  if(timer) {
			window.clearTimeout(timer);
		  }
		  timer = window.setTimeout(function() {
			if(($(window).scrollTop() + $(window).height() > $(document).height()) - 300 && content) {
			  loadItems();
			}
		  }, 200);
		});
	  }

	  // Scroll globals
	  var pageNum = 0; // The latest page loaded
	  var hasNextPage = true; // Indicates whether to expect another page after this one
	  var loadItems = function() {
		// If the next page doesn't exist, just quit now
		if (hasNextPage === false) {
		  return false;
		}
		// Update the page number
		pageNum = pageNum + 1;
		// Configure the url we're about to hit
		$.ajax({
		  type: "GET",
		  url: '{%url "empresa-oportunidad-busqueda" %}',
		  data: {callback: pageNum},
		  dataType: 'json',
		  success: function(data) {
			// Update global next page variable
			//hasNextPage = true;//.hasNext;
			for (var i in data) {
			  addOportunidad(data[i].fields, '#oportunidad-lista');
			}
		  },
		  error: function() {
			// When I get a 400 back, fail safely
			hasNextPage = false;
			content = false;
			var op = $('<class="oportunidad-estadistica">No more news</li>');
			op.appendTo('#oportunidad-lista');
			$('#loading-image').hide();
		  },
		});
	  };
	  loadItems(); // loads first five stories on page load
	  //binds ajax start/stop events to a loading gif
	  $('#loading-image').bind('ajaxStart', function(){
		$(this).show();
	  }).bind('ajaxStop', function(){
		$(this).hide();
	  });
	}());

</script>

{% endblock %}
