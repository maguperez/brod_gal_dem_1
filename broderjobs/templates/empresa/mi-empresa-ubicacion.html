<div style="margin:0 50px">
	<form class="form-horizontal" action="{% url 'mi-empresa-ubicacion' %}" method="post">{%csrf_token%}
        {{form.direccion_map}}
        {{form.longitud}}
        {{form.latitud}}
		<!--<input type="submit" class="btn btn-submit col-md-offset-2">-->
	</form>
</div>
<div id = "ubicacion-map" style = "height: 350px"></div>
<script>
    var Ubicacion = {
        map: null,
        marca: null,
        inicializar_mapa: function() {
            var mapCanvas = document.getElementById('ubicacion-map');
            var mapOptions = {
                center: new google.maps.LatLng(44.5403, -78.5463),
                zoom: 8,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            Ubicacion.map = new google.maps.Map(mapCanvas, mapOptions);
            google.maps.event.addListener(Ubicacion.map, 'click', function(event) {
                Ubicacion.marcar_mapa(event.latLng);
            });
            if ($("#id_latitud").val() != ""){
                var latitud = $("#id_latitud").val();
                var longitud = $("#id_longitud").val();
                var punto = new google.maps.LatLng(latitud, longitud);
                Ubicacion.marcar_mapa(punto);
            }
        },
        marcar_mapa: function(coordenadas){
            Ubicacion.borrar_marca();
            var marker = new google.maps.Marker({
                position: coordenadas,
                map: Ubicacion.map
            });
            Ubicacion.marca = marker;
            google.maps.event.addListener(marker, "rightclick", function (point) {
                Ubicacion.borrar_marca();
            });
            Ubicacion.map.setCenter(coordenadas);
            $("#id_latitud").val(coordenadas.lat());
            $("#id_longitud").val(coordenadas.lng());

            var geocoder = new google.maps.Geocoder();
            geocoder.geocode({
                location: new google.maps.LatLng(coordenadas.lat(),coordenadas.lng())
                }, function (response, status) {
                    if (response != null && response.status != "ZERO_RESULTS")
                        $("#id_direccion_map").val(response[0]["formatted_address"]);
            });
        },
        borrar_marca: function(){
            if (Ubicacion.marca != null) {
                Ubicacion.marca.setMap(null);
                Ubicacion.marca = null;
            }
        },
    };
    var interval;
    $(function(){
        interval = setInterval(function(){
            if ($("#ubicacion-map").width != 0){
                clearInterval(interval);
                Ubicacion.inicializar_mapa();
            }
        }, 1000);
        $("#form-modal .modal-title").html('<i class="location"></i>Ubicaci√≥n');
        $("#id_latitud, #id_longitud, #id_direccion_map").hide();

    });

</script>