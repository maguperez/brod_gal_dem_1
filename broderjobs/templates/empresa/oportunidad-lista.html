
{% extends 'empresa/base.html' %}
{% load staticfiles %}
{% block content %}
<section class="oportunidades-empresa" data-id="{{oportunidad.od}}">
			<div class="centered">
				<select class="filtro" id="filtro">
					<option value="A">Postulaciones Abiertas</option>
					<option value="C">Postulaciones Cerradas</option>
					<option value="P">Oportunidades Archivadas</option>
				</select>
				<div class="clear"></div>
				<ul class="list" id ="oportunidad-lista"></ul>
				<div id="vacio"></div>
			</div>
	<div id="archivar-modal" class="modal fade">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h3 class="modal-title"><strong>Archivar Oportunidad</strong></h3>
                    </div>
             <div id="archivar-modal-body" class="modal-body">
				<p>Al archivar la Oportunidad todas las postulaciones relacionadas serán
					finalizadas.</p>

			</div>
            <div class="modal-footer">
				<button type="button" class="btn btn-default btn-archivar" id="btn_archivar">Aceptar</button>
				<button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->

</section>

{% csrf_token %}
{% endblock%}
{% block js %}
<script type="text/javascript">
	$( document ).ready( function() {
		$( '#filtro' ).change( function() {
			fnCargarOportunidades();
		});
		fnCargarOportunidades();
		$('#oportunidad-lista').on('click', '.archivar', function(){
			$('.btn-archivar').data('id', $(this).data('id'));
			$("#archivar-modal-body").html('<p>Al archivar la Oportunidad todas las postulaciones' +
					                       ' relacionadas serán finalizadas</p>');
			$('.btn-archivar').show();
        	$('#archivar-modal').modal('toggle');

		});
		$('.oportunidades-empresa').on('click', '.btn-archivar', function(){
			var id = $(this).data('id');
        	$.get("{% url 'oportunidad-archivar' %}?id=" +id, function(data){
				$("#archivar-modal-body").html('<p>'+data+'</p>');
				$('.btn-archivar').hide();
				$("#oportunidad-lista li[data-id='"+id+"']").hide();
			});
		});

	});


	function opciones(id) {
		if ($('#menu-' + id).hasClass('active'))
			$('#menu-' + id).removeClass('active');
		else
			$('#menu-' + id).addClass('active')
	}
	function fnCargarOportunidades(){
		$.ajax({
				data: {'b': $( '#filtro' ).val() },
				url: "{% url 'empresa-oportunidad-buscar' %}",
				type: 'get',
				success: function (data) {
					var par = '';
					$('#oportunidad-lista').html('');
					if (data.length > 0)
						fnCargarOportunidad(data, 0);
					else
						$('#vacio').html('<h4>No se encontraron resultados</h4>');
				}
			});
	}
	function fnCargarOportunidad(arra, index) {
		$(".loading-wrapper").show();
		if (arra.length > index){
			$.get("{% url 'empresa-oportunidad-cargar-lista' %}?id=" + arra[index].id, function(htmlexterno){
   				$('#oportunidad-lista').append(htmlexterno);
				fnCargarOportunidad(arra, index+1);
			});
		}
		else{
			$(".loading-wrapper").hide();
		}
	}

</script>



{%endblock%}