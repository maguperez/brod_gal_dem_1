{% extends 'empresa/base.html' %}
{% block content %}
{% load staticfiles %}
<!--<script type="text/javascript" src="{% static 'js/bootstrap-datepicker.min.js' %}"></script>-->
<!--<script type="text/javascript" src="{% static 'js/bootstrap-datepicker.es.min.js' %}"></script>-->
<!--<script type="text/javascript" src="{% static 'js/bootstrap-slider.js' %}"></script>-->
<!--<link rel="stylesheet" href="{% static 'css/bootstrap-datepicker.min.css' %}">-->
<!--<link rel="stylesheet" href="{% static 'css/slider.css' %}">-->
<script src="https://maps.googleapis.com/maps/api/js"></script>
<style>
	.tooltip-manual + .tooltip, input + .tooltip, select + .tooltip {
		width: 167px;
	}

	.tooltip-arrow{
		top: 44.1754%;
	}

	.tooltip-manual + .tooltip .tooltip-inner, .tooltip .tooltip-inner{
		background-color: #f50 !Important;
	}

	.tooltip-manual + .tooltip{
		top: 0px !Important;
	}

	.tooltip-manual + .tooltip .tooltip-arrow, .tooltip .tooltip-arrow{
		border-left-color: #f50 !Important;
		border-right-color: #f50 !Important;
	}

</style>
<form action="" method="post" autocomplete="off">{%csrf_token%}
	<section class="oportunidad-detalle">
			<div class="centered">
                <div>
					<ol class="breadcrumb">
						<li class="active">{{oportunidad.titulo}}</li>
						<li>Editar oportunidad</li>
					</ol>
					<div class="clear"></div>
				</div>
				<div class="panel left principal">
					<div class="box">
						<header>
							<div class="descripcion">
								<h3>Editar Oportunidad</h3>
								<label class="indicacion">Los campos marcados con (*) son obligatorios</label>
							</div>
                            <div class = "col-sm-3"></div>
                            <!--<input type="submit" name="_guardar" value="GUARDAR" id="guardar" class="btn-action" />-->
							<input type="submit" name="_cancelar" value="CANCELAR" id="cancelar" class="btn-action"/>
							{% if oportunidad.estado_oportunidad != 'P' %}
								<input type="submit" name="_guardar" value="GUARDAR" id="guardar" class="btn-action"/>
								<input type="submit" name="_archivar" value="ARCHIVAR" id="anunciat" class="btn-action" style="display: none;"/>

							{%else%}
								<input type="submit" name="_abrir" value="ABRIR" id="abrir" class="btn-action"/>
							{%endif%}<br><br>
{#                            <div style = "text-align:center; float:right; diaplay:none;"><label style = "display:inline-block">Estado: &nbsp;</label>#}
{#                                <div style = "display: inline-block">{{form.estado_oportunidad}}</div></div>#}
{#								<div class="clear"></div>#}

						</header>
						{% if form.errors %}
							{% for field in form %}
								{% for error in field.errors %}
									<div class="alert alert-error" style="border: 1px solid #8c8c8c">
										<strong> {{field.label}}: </strong>
										<strong>{{ error|escape }}</strong>
									</div>
								{% endfor %}
							{% endfor %}
							{% for error in form.non_field_errors %}
								<div class="alert alert-error">
									<strong>{{ error|escape }}</strong>
								</div>
							{% endfor %}
						{% endif %}
						<div class="content">

							<section class="perfil">
								<h2 class="title bold"><i class="work"></i>Perfil de la oportunidad</h2>
								<div class="detalle ">

									<div class ="form-group">
										<label class = "col-sm-3 control-label">T&iacute;tulo de vacante</label>
										<div class = "col-sm-9">
											{{form.titulo}}
										</div>
										<div class="clear"></div>
									</div>
									<div class ="form-group carga_horaria">
										<label class = "col-sm-3 control-label">Jornada de trabajo</label>
										<div class = "col-sm-9">
											{% for carga in form.carga_horaria %}
											 	{{ carga.errors }}
											 	{{ carga }}
											{% endfor %}
										</div>
										<div class="clear"></div>
									</div>
									<div class ="form-group">
										<label class = "col-sm-3 control-label">Localizaci&oacute;n</label>
										<div class = "col-sm-4">
											{{form.pais}}
										</div>
										<div class = "col-sm-4">
											<select class="full actualizar" id="id_ciudad"></select>
											{{form.ciudad_hidden}}
											<div class="tooltip-manual" id="tooltip-pais"></div>
										</div>
										<div class="clear"></div>
									</div>
									<div class ="form-group remuneracion">
										<label class = "col-sm-3 control-label">Remuneraci&oacute;n</label>
										<div class = "col-sm-9">
											{% for r in form.remuneracion %}
											 	{{ r.errors }}
											 	{{ r }}
											{% endfor %}
										</div>
									</div><br><br>
									<div class ="form-group">
										<label class = "col-sm-3"></label>
										<div class = "col-sm-4">
											{{form.remuneracion_min}}
										</div>
										<div class = "col-sm-4">
											{{form.remuneracion_max}}
										</div>
										<div class="clear"></div>
									</div>
									<div class ="form-group">
										<label class = "col-sm-3">Fecha de cierre</label>
										<div class = "col-sm-4">
											{{form.fecha_cese}}
										</div>
										<div class="clear"></div>
									</div>
								</div>
							</section>
							<section class="informacion">
								<h2 class="title bold"><i class="info"></i>Informaci&oacute;n b&aacute;sica</h2>
								<div class="detalle">
									<div class ="form-group tipo_puesto">
										<label class = "col-sm-3 control-label">Tipo de vacante *</label>
										<div class = "col-sm-9">
											{% for puesto in form.tipo_puesto %}
											 	{{ puesto.errors }}
											 	{{ puesto }}
											{% endfor %}
										</div>
										<div class="clear"></div>
									</div>
									<div class="full less-margin">
										<label>Resumen *</label>
									</div>
									<div class="full">
										{{form.resumen}}
									</div>
								</div>
							</section>
							<section class="perfil">
								<h2 class="title bold"><i class="profile"></i>Perfil del candidato</h2>
								<div class="detalle">
                                    <div class ="form-group">
										<label class = "col-sm-3">Rango de Edad</label>
										<div class = "col-sm-4">
											{{form.edad_desde}}
										</div>
										<div class = "col-sm-4">
											{{form.edad_hasta}}
										</div>
										<div class="clear"></div>
									</div>
                                    <div class ="form-group ">
										<label class = "col-sm-3 control-label">Género</label>
										<div class = "col-sm-9">
											{{form.genero}}
										</div>
										<div class="clear"></div>
									</div>
									<div class ="form-group ">
										<label class = "col-sm-3 control-label">Grado de estudio *</label>
										<div class = "col-sm-9">
											{{form.grado_estudio}}
											<div class="tooltip-manual" id="tooltip-grado-estudio"></div>
											<label class="descripcion">Defina el nivel de graduaci&oacute;n del candidato</label>
										</div>
										<div class="clear"></div>
									</div>
									<div class ="form-group ">
										<label class = "col-sm-3 control-label">Universidades de preferencia</label>
										<div class = "col-sm-9">
											{{form.universidad}}
											<label class="descripcion">Complete este campo s&oacute;lo si tiene una preferencia por los candidatos de alguna universidad. Introduzca las siglas de la universidad y seleccione de la lista.</label>
										</div>
										<div class="clear"></div>
									</div>
                                    <div class ="form-group ">
										<label class = "col-sm-3 control-label">Tipo Carrera *</label>
										<div class = "col-sm-9">
											{{form.tipo_carrera}}
											<div class="tooltip-manual" id="tooltip-tipo-carrera"></div>
											<label class="descripcion">En caso los candidatos no necesiten de educación superior, escoja las tipo carreras compatibles con el área donde el profesional actuará.</label>
										</div>
										<div class="clear"></div>
									</div>
									<div class ="form-group ">
										<label class = "col-sm-3 control-label">Carrera *</label>
										<div class = "col-sm-9">
											{{form.carrera}}
											<div class="tooltip-manual" id="tooltip-carrera"></div>
											<label class="descripcion">En caso los candidatos no necesiten de educación superior, escoja las carreras compatibles con el área donde el profesional actuará.</label>
										</div>
										<div class="clear"></div>
									</div>
									<div class ="form-group ">
										<label class = "col-sm-3 control-label">Periodo de graduaci&oacute;n</label>
										<div class = "col-sm-9">
											<div class="row">
											<label class="col-sm-12" id="periodo-descripcion" style="font-size: 10pt;"><b>Estudiantes de 7° hasta graduados hace un a&ntilde;o</b></label>
											</div>
											<div class="row">
												{{form.periodo_graduacion_hidden}}
												<div class="col-sm-12">
													<input id="slider-periodo" type="text" class="slider"/>
												</div>
											</div>
										</div>
										<div class="clear"></div>
									</div>
									<div class ="form-group ">
										<label class = "col-sm-3 control-label">Idiomas</label>
										<div class = "col-sm-9">
											{{form.idioma}}
										</div>
										<div class="clear"></div>
									</div>
									<div class ="form-group ">
										<label class = "col-sm-3 control-label">Conocimientos</label>
										<div class = "col-sm-9">
											{{form.conocimiento}}
										</div>
										<div class="clear"></div>
									</div>
								</div>
							</section>
							<section class="beneficios">
								<h3 class="title"><i class="like"></i>Beneficios</h3>
								<div class="detalle">
									<div class ="form-group ">
										<label class = "col-sm-3 control-label">Beneficios</label>
										<div class = "col-sm-9">
											<!--{{form.beneficio}}-->
											<select multiple class="full" id="id_beneficio">
												{% for beneficio in beneficios %}
													<option value="{{beneficio.id}}" data-info="b" selected>{{beneficio.descripcion}}</option>
												{% endfor %}
												{% for beneficio in beneficios_extra %}
													<option value="{{beneficio.id}}" data-info="be" selected>{{beneficio.descripcion}}</option>
												{% endfor %}
												{% for beneficio in beneficios_universo %}
													<option value="{{beneficio.id}}" data-info="b">{{beneficio.descripcion}}</option>
												{% endfor %}
											</select>
											{{form.beneficios_hidden}}
											{{form.beneficios_nuevos_hidden}}
											{{form.beneficios_extras_hidden}}
										</div>
										<div class="clear"></div>
									</div>
								</div>
							</section>
							<section class="Oportunidad">
								<h3 class="title"><i class="location"></i>Ubicaci&oacute;n</h3>
								<div class="detalle ">
									<div class ="form-group ">
										<label class = "col-sm-3 control-label">Direcci&oacute;n</label>
										<div class = "col-sm-9">
											{{form.direccion_map}}
										</div>
									</div><br><br>
									<div class ="form-group ">
										<label class = "col-sm-3"></label>
										<div class = "col-sm-3 hidden">
											{{form.latitud}}
										</div>
										<div class = "col-sm-3 hidden">
											{{form.longitud}}
										</div>
										<div class="clear"></div>
									</div>
									<div id="map" style = "height: 350px; width: 100%"></div>
								</div>
							</section>
						</div>
					</div>
				</div>
				<div class="panel right">
					<div class="box alcance">
						<div class="content">
							<section class="grafico">
								<h4>Alcance de Candidatos</h4>
								<label><i class="alcance bajo"></i><span class="cifra"></span> candidatos</label>
								<div class="grafico-alcance">
									<div class="alto inactive">
										<div class="adecuado inactive">
											<div class="bajo inactive">
												<label>Bajo</label>
											</div>
										</div>
									</div>
								</div>
							</section>
							<section class="caracteristicas">
								<label><span class="bold">Carrera: </span>Ingenier&iacute;a Industrial, Administraci&oacute;n, Hoteler&iacute;a</label>
								<label><span class="bold">Idiomas: </span>Ingl&eacute;s avanzado</label>
								<label><span class="bold">Conocimientos: </span>Office</label>
								<label><span class="bold">Jornada: </span>Full time</label>
								<label><span class="bold">Ubicaci&oacute;n: </span>Lima, Per&uacute;</label>
							</section>
						</div>
					</div>
				</div>
				<div class="clear"></div>
			</div>
		</section>
</form>

<div id="form-modal" class="modal fade">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h3 class="modal-title"><strong>AVISO!!!</strong></h3>
                    </div>
            <div id="form-modal-body" class="modal-body">
				<p>Al archivar la Oportunidad pasará a estado Cerrada, y todas las postulaciones relacionadas seran canceladas.</p>
			</div>
            <div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<style>
	.jornada_trabajo label:nth-of-type(n+2),
	.remuneracion label:nth-of-type(n+2),
	.tipo_puesto label:nth-of-type(n+2){
		margin-left: 10px;
		display: inline-block;
	}
	#map {
		width: 100%;
		height: 350px;
	}
	.oportunidad-detalle label {
		font-size: 14.3px;
	}
</style>
<script>
    var periodoGraduacion = [
		{secuencia: 1,descripcion:'Ciclo 1'},
		{secuencia: 2,descripcion:'Ciclo 2'},
		{secuencia: 3,descripcion:'Ciclo 3'},
		{secuencia: 4,descripcion:'Ciclo 4'},
		{secuencia: 5,descripcion:'Ciclo 5'}];
	$(function(){
        $('textarea').each(function(){
            $(this).after("<div class = 'textarea-feedback'></div>");
            var text_length = $(this).val().length;
            $(this).next().html(text_length + ' caracteres');
        });

        $('textarea').on("keyup", function() {
            var text_length = $(this).val().length;
            $(this).next().html(text_length + ' caracteres');
        });
		$(window).scroll(function() {
			if ( $(this).scrollTop() > 60 )
				$(".box.alcance").addClass("fixed");
			else $(".box.alcance").removeClass("fixed");
		});
		if(window.location.href.indexOf("archivar") >= 0){
			$("#id_estado_oportunidad").val("C").trigger("change");
			$('#form-modal').modal('toggle');
		}

		$("input:not([type=submit]):not(:radio), select, textarea").addClass("form-control");

		var elementosParaSelect2 = ['id_universidad','id_carrera','id_idioma', 'id_conocimiento','id_beneficio','id_grado_estudio', 'id_genero'];

		InicializarSelect2(elementosParaSelect2);
		InicializarValidaciones();

        $("#id_tipo_carrera").change(function() {
			resetCarrera();
			if($("#id_tipo_carrera").val() > 0 ){
				ActualizarListadoCarreras();
				ActualizarListadoPeriodoGraduacion();
			}
			else{
				$('#slider-periodo').slider('setAttribute', 'enabled', false);
				$('#slider-periodo').slider('refresh');
				$('#id_periodo_graduacion_hidden').val('');
			}

			$("#tooltip-carrera").tooltip('hide');
			LlamarValidacionElemento('id_tipo_carrera');
		});

		$("#link-oportunidades").addClass("active");

		$("#id_fecha_cese").datepicker({
			autoclose: true,
			language: 'es',
			format: "dd/mm/yyyy",
		});
		$("#slider-periodo").slider({
			min: 1,
			max: 5,
			value: [1,4],
			tooltip: 'hide',
			enabled: false,
			formatter: function(value){
				var cadena = '';
				if(periodoGraduacion){
					var objetoMin = _.find(periodoGraduacion, function(o) { return o.secuencia == value[0]; });
					var objetoMax = _.find(periodoGraduacion, function(o) { return o.secuencia == value[1]; });
					if(objetoMin && objetoMax){
						cadena = objetoMin.descripcion+' , '+objetoMax.descripcion;
						$('#periodo-descripcion b').text(cadena);

						cad_id =  objetoMin.id+','+objetoMax.id;

						$('#id_periodo_graduacion_hidden').val(cad_id);
					}
					else{
						cadena = value;
					}
				}
				else{
						cadena = value;
					}
				return cadena;
			}
		});
		Editar.inicializar_mapa();
		$("#id_pais").select2({
  			placeholder: "Pais",
  			//allowClear: true
		});
		$("#id_ciudad").select2({
  			placeholder: "Ciudad",
  			//allowClear: true
		});
		$("#id_pais").change(function() {
			if($("#id_pais").val() > 0 ){
				$.ajax({
					data: {'pais': $("#id_pais").val()},
					url: '{%url "ciudad-busqueda" %}',
					type: 'get',
					success: function (data) {
						if (data) {
							if (data.length > 0) {
//								var options = '<option value="">Ciudad</option>';
								var options = '';
								for (var i = 0; i < data.length; i++) {
									options += '<option value="' + data[i].pk + '">' + data[i].fields['descripcion'] + '</option>';
								}
								$("#id_ciudad").html(options);
								// $("#id_ciudad option:first").attr('selected', 'selected');
								$("#id_ciudad").select2("val", "");
								$("#id_ciudad").attr('disabled', false);
							}
						}
					}
				});
			}
			else{
				var options = '';
				$("#id_ciudad").html(options);
				$("#id_ciudad").select2("val", "");
				$("#id_ciudad").attr('disabled', false);
			}
		});
		$("#id_ciudad").change(function() {
			$('#id_ciudad_hidden').val($(this).val());
		});

		$("#id_beneficio").change(function() {

			var existentes = $("#id_beneficio option:selected[data-info='b']").map(function(){return this.value}).get();
			$('#id_beneficios_hidden').val(existentes);

			var extras = $("#id_beneficio option:selected[data-info='be']").map(function(){return this.value}).get();
			$('#id_beneficios_extras_hidden').val(extras);

			var nuevos = $("#id_beneficio option:selected[data-select2-tag='true']").map(function(){return this.value}).get();
			$('#id_beneficios_nuevos_hidden').val(nuevos);
		});

		$("#cancelar").click(function(){
			window.history.back();
		});

		IniciarCiudades();
		RevisarCheckedRemuneración();
		AgregarEventosRemuneracion();

	});
    function resetCarrera(){
		var options = '';
		$("#id_carrera").html(options);
		$("#id_carrera").select2("val", "");
		$("#id_carrera").attr('disabled', false);
		$("#id_carrera").trigger("change");
	}
    function LlamarValidacionElemento(id){
		var validator = $( "form" ).validate();
		validator.element('#'+id);
	}
   	function ActualizarListadoCarreras(){
		$.ajax({
					data: {'tipo': $("#id_tipo_carrera").val()},
					url: '{%url "carrera-busqueda-por-tipo" %}',
					type: 'get',
					success: function (data) {
						if (data) {
							if (data.length > 0) {
								var options = '';
								for (var i = 0; i < data.length; i++) {
									options += '<option value="' + data[i].pk + '">' + data[i].fields['descripcion'] + '</option>';
								}
								$("#id_carrera").html(options);
								$("#id_carrera").select2("val", "");
								$("#id_carrera").attr('disabled', false);
								$("#tooltip-carrera").tooltip('hide');
							}
							else{
								resetCarrera();
								$("#tooltip-carrera").tooltip('hide');
							}
						}
						else{
							resetCarrera();
							$("#tooltip-carrera").tooltip('hide');
						}
					}
				});
	}
   	function ActualizarListadoPeriodoGraduacion(){
		$.ajax({
					data: {'tipo': $("#id_tipo_carrera").val()},
					url: '{%url "periodos-graduacion-busqueda" %}',
					type: 'get',
					success: function (data) {
						if (data) {
							if (data.length > 0) {

								var ordenado = _.sortBy(data,'secuencia');

								$('#slider-periodo').slider('setAttribute', 'min', _.head(ordenado).secuencia);
								$('#slider-periodo').slider('setAttribute', 'max', _.last(ordenado).secuencia);
								$('#slider-periodo').slider('setAttribute', 'enabled', true);
								$('#slider-periodo').slider('refresh');

								periodoGraduacion = data;
							}
						}
					}
				});
	}
	function RevisarCheckedRemuneración(){
		var listaCheck = [{index:0,funcion:LogicaFijo},{index:1,funcion:LogicaIntervalo},{index:2,funcion:LogicaSinEspecificar}];

		for (var i = 0, len = listaCheck.length; i < len; i++) {
			var obj = listaCheck[i];
		  if($('#id_remuneracion_'+obj.index).is(':checked')){
			  obj.funcion();
			  break;
		  }
		}
	}

	function LogicaSinEspecificar(){
		$('#id_remuneracion_min').prop( "disabled", true );
		$('#id_remuneracion_max').prop( "disabled", true );
		$('#id_remuneracion_min').val('');
		$('#id_remuneracion_max').val('');
		$('#id_remuneracion_min').prop( "placeholder", 'Valor minimo' );
		$('#id_remuneracion_min').hide();
		$('#id_remuneracion_max').hide();
		$("#id_remuneracion_min").tooltip('hide');
		$("#id_remuneracion_max").tooltip('hide');
	}

	function LogicaIntervalo(){
		$('#id_remuneracion_min').prop( "disabled", false );
		$('#id_remuneracion_max').prop( "disabled", false );
		$('#id_remuneracion_min').prop( "placeholder", 'Valor minimo' );
		$('#id_remuneracion_max').show();
		$('#id_remuneracion_min').show();
		$("#id_remuneracion_min").tooltip('hide');
		$("#id_remuneracion_max").tooltip('hide');
	}

	function LogicaFijo(){
		$('#id_remuneracion_max').prop( "disabled", true );
		$('#id_remuneracion_min').prop( "disabled", false );
		$('#id_remuneracion_min').prop( "placeholder", 'Valor fijo' );
		$('#id_remuneracion_max').hide();
		$('#id_remuneracion_min').show();
		$('#id_remuneracion_max').val('');
		$("#id_remuneracion_min").tooltip('hide');
		$("#id_remuneracion_max").tooltip('hide');
	}

	function AgregarEventosRemuneracion(){
		$('#id_remuneracion_2').click(LogicaSinEspecificar);
		$('#id_remuneracion_1').click(LogicaIntervalo);
		$('#id_remuneracion_0').click(LogicaFijo);
	}

	var Editar = {
        map: null,
        marca: null,
        inicializar_mapa: function() {
            var mapCanvas = document.getElementById('map');
            var mapOptions = {
                center: new google.maps.LatLng(-12.0570208,-77.0372896),
                zoom: 15,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            Editar.map = new google.maps.Map(mapCanvas, mapOptions);
            google.maps.event.addListener(Editar.map, 'click', function(event) {
                Editar.marcar_mapa(event.latLng);
            });
            if ($("#id_latitud").val() != ""){
                var latitud = $("#id_latitud").val();
                var longitud = $("#id_longitud").val();
                var punto = new google.maps.LatLng(latitud, longitud);
                Editar.marcar_mapa(punto);
            }
        },
        marcar_mapa: function(coordenadas){
            Editar.borrar_marca();
            var marker = new google.maps.Marker({
                position: coordenadas,
                map: Editar.map
            });
            Editar.marca = marker;
            google.maps.event.addListener(marker, "rightclick", function (point) {
                Editar.borrar_marca();
            });
            Editar.map.setCenter(coordenadas);
            $("#id_latitud").val(coordenadas.lat());
            $("#id_longitud").val(coordenadas.lng());

            var geocoder = new google.maps.Geocoder();
            geocoder.geocode({
                location: new google.maps.LatLng(coordenadas.lat(),coordenadas.lng())
                }, function (response, status) {
                    if (response != null && response.length > 0 && response.status != "ZERO_RESULTS")
                        $("#id_direccion_map").val(response[0]["formatted_address"]);
            });
        },
        borrar_marca: function(){
            if (Editar.marca != null) {
                Editar.marca.setMap(null);
                Editar.marca = null;
            }
        },
    };

	function InicializarSelect2(ids){

		ids.forEach(function(id){
			if(id=='id_beneficio'){

				$("#"+id).select2({
					placeholder: "Seleccione por favor",
					//allowClear: true,
					tags: true,
					tokenSeparators: [',']
				});
			}
			else{
				$("#"+id).select2({
					placeholder: "Seleccione por favor",
					//allowClear: true
				});
			}
		});
	}

	function ConfigurarTooltip(elemento,error,orientacion){
		$(elemento).tooltip('destroy');
		$(elemento).tooltip({
			animation: true,
			placement: orientacion,
			title: $(error).text(),
			trigger: "manual"
		});
		$(elemento).tooltip('show');
	}

	function InicializarValidaciones(){

		$.validator.addMethod('MaximoMayorMinimo',function(value, element, param){

			var valorRetorno = true;

			if($('#id_remuneracion_1').is(':checked')){
				if($('#id_remuneracion_min').val() && $('#id_remuneracion_max').val()){
					var montoMinimo = parseInt($('#id_remuneracion_min').val(),10);
					var montoMaximo = parseInt($('#id_remuneracion_max').val(),10);

					if(montoMinimo > montoMaximo){
						valorRetorno = false;
					}
				}
			}
			return valorRetorno;

		},'Valor maximo debe ser mayor que Valor minimo');
        $.validator.addMethod('RangoEdad',function(value, element, param) {
            return $("#id_edad_desde").val() <= $("#id_edad_hasta").val();
        },'Edad máxima debe ser mayor o igual que edad mínima');
		$("form").validate({
            errorPlacement: function (error, element) {
                if(element[0].id == 'id_pais'){
					ConfigurarTooltip('#tooltip-pais',error,"right");
				}
				else if(element[0].id == 'id_carrera'){
					ConfigurarTooltip('#tooltip-carrera',error,"right");
				}
				else if(element[0].id == 'id_grado_estudio'){
					ConfigurarTooltip('#tooltip-grado-estudio',error,"right");
				}
				else if(element[0].id == 'id_remuneracion_min'){
					ConfigurarTooltip(element,error,"left");
				}
				else if(element[0].id == 'id_tipo_puesto_0'){
					ConfigurarTooltip('#id_tipo_puesto_2',error,"left");
				}
				else{
					ConfigurarTooltip(element,error,"right");
				}

            },
            success: function (label, element) {
                $(element).tooltip('hide');
            },
            rules: {
				titulo: {
                    required: true
                },
                resumen: {
                    required: true
                },
				carrera: {
					required: true
				},
				tipo_puesto:{
                    required: true
                },
				grado_estudio:{
                    required: true
                },
				pais:{
                    required: true
                },
				id_ciudad:{
                    required: true
                },
				fecha_cese:{
                    required: true
                },
				remuneracion_min:{
					required: true,
					digits: true,
					maxlength: 7
				},
				remuneracion_max:{
					required: true,
					digits: true,
					maxlength: 7,
					MaximoMayorMinimo: ''
				},
                edad_desde: {
                    RangoEdad: true,
                    min: 1
                },
                edad_hasta: {
                    RangoEdad: true,
                    min: 1
                }

            },
            messages: {
                titulo: {
                    required: "Este campo es obligatorio"
                },
				resumen: {
                    required: "Este campo es obligatorio"
                },
				carrera: {
                    required: "Este campo es obligatorio"
                },
				tipo_puesto:{
                    required: "Este campo es obligatorio"
                },
				grado_estudio:{
                    required: "Este campo es obligatorio"
                },
				pais:{
                    required: "Este campo es obligatorio"
                },
				id_ciudad:{
                    required: "Este campo es obligatorio"
                },
				fecha_cese:{
                    required: "Este campo es obligatorio"
                },
				remuneracion_min:{
					required: "Este campo es obligatorio",
					digits: "Este campo es numérico",
					maxlength: "Este campo no puede tener más de 7 caracteres"
				},
				remuneracion_max:{
					required: "Este campo es obligatorio",
					digits: "Este campo es numérico",
					maxlength: "Este campo no puede tener más de 7 caracteres"
				},
                edad_desde: {
                    min: "Debe ser un número mayor a 1"
                },
                edad_hasta: {
                    min: "Debe ser un número mayor a 1"
                }
            }
        });
	}

	function IniciarCiudades() {
		$.ajax({
			data: {'pais': $("#id_pais").val()},
			url: '{%url "ciudad-busqueda" %}',
			type: 'get',
			success: function (data) {
				if (data) {
					if (data.length > 0) {
						var options = '';
						for (var i = 0; i < data.length; i++) {
							options += '<option value="' + data[i].pk + '">' + data[i].fields['descripcion'] + '</option>';
						}
						$("#id_ciudad").html(options);
						$("#id_ciudad").val($("#id_ciudad_hidden").val()).trigger("change");
						$("#id_ciudad").attr('disabled', false);
					}
				}
			}

		});
	}

    $('.actualizar').change(function(){
{#        alert("cambio");#}
            ids = new Array();
            ids_estudiante = new Array();
            ids_estudiante = $(".candidatos").val();
            var form = new FormData();
            form.append('carrera', $('#id_carrera').val()== null ? 0 : $('#id_carrera').val() );
            form.append('universidad', $('#id_universidad').val() == null ? 0 : $('#id_universidad').val() );
            form.append('grado_estudio', $('#id_grado_estudio').val() == '' ? 0 : $('#id_grado_estudio').val() );
            form.append('edad_desde', $('#id_edad_desde').val() == '' ? 0 : $('#id_edad_desde').val() );
            form.append('edad_hasta', $('#id_edad_hasta').val() == '' ? 0 : $('#id_edad_hasta').val() );
            form.append('pais', $('#id_pais').val() == '' ? 0 : $('#id_pais').val() );
            form.append('ciudad', $('#id_ciudad').val() == '' ? 0 : $('#id_ciudad').val() );
            form.append('genero', $('#id_genero').val() == '' ? 0 : $('#id_genero').val() );
            form.append('tipo_puesto', $('input[name=tipo_puesto]:checked').val() == null ? 0 : $('input[name=tipo_puesto]:checked').val() );
            form.append('carga_horaria',$('input[name=carga_horaria]:checked').val() == null ? 0 :$('input[name=carga_horaria]:checked').val() );
            form.append('idioma', $('#id_idioma').val()== null ? 0 : $('#id_idioma').val() );
            form.append('conocimiento', $('#id_conocimiento').val()== null ? 0 : $('#id_conocimiento').val() );
            form.append('csrfmiddlewaretoken',$('[name="csrfmiddlewaretoken"]').val());
            $(".alcance .cifra").html("Calculando...");
            $.ajax({
                type:"POST",
                url:"{%url 'total-compatibles' %}",
                data: form,
                processData: false,
                contentType: false,
                error: function(x){
                    console.log(x);
{#                    $(".alcance .cifra").html("error...");#}
                },
                success: function(data){
                    $(".alcance .cifra").html(data.total);
                    $(".grafico-alcance div").removeClass("active");

                    if (data.nivel <= 29){
                        $(".grafico-alcance .bajo").removeClass("inactive");
                        $(".grafico-alcance .bajo").addClass("active");
                        $(".grafico-alcance label").html("Bajo");
                    }
                    else if (data.nivel <= 70){
                        $(".grafico-alcance .adecuado").removeClass("inactive");
                        $(".grafico-alcance .adecuado").addClass("active");
                        $(".grafico-alcance label").html("Medio");
                    }
                    else {
                        $(".grafico-alcance .alto").removeClass("inactive");
                        $(".grafico-alcance .alto").addClass("active");
                        $(".grafico-alcance label").html("Alto");
                    }
                }
            });
       });


</script>

{% endblock%}