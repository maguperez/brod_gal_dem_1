{% extends 'estudiante/base.html' %}
{% block content %}
<section class="oportunidad-detalle">
	<div class="centered">
		<div class="panel left principal">
			<div class="box">
				<header class="oportunidad-resumen">
					<img class="imagen" src="{{empresa.set_logo}}" alt="{{empresa.nombre}}" />
					<div class="detalle">
						<h1>{{oportunidad.titulo}}</h1>
						<a href=""><h4 class="link">{{empresa.nombre | upper}}</h4></a>
						<label>{{oportunidad.ciudad}}, {{oportunidad.pais}}</label>
						<label>Remuneraci&oacute;n: {{oportunidad.remuneracion}}</label>
					</div>
					<div class="postulacion">
						<a id="postular" class="{% if postulacion.estado == 'A'%} btn-action-invertido
							{%else %}btn-action{%endif%}">{% if postulacion.estado == 'A'%}CANCELAR{%else %}POSTULAR{%endif%}</a>
						<label class="cierre">CIERRA EL {{oportunidad.fecha_cese}}</label>
					</div>
					<div class="clear"></div>
				</header>
				<div class="content">
					<section class="informacion">
						<h3 class="title"><i class="info"></i>{{oportunidad.titulo}}</h3>
						<div class="detalle">
							<div class = "row">
								<label class = "col-sm-3">Tipo de vacante</label>
								<div class = "col-sm-9">{{oportunidad.tipo_puesto}}</div>
								<div class="clear"></div>
							</div>
							<div class = "row">
								<label class = "col-sm-3">Jornada de trabajo</label>
								<div class = "col-sm-9">{{oportunidad.carga_horaria}}</div>
								<div class="clear"></div>
							</div>
							<div class = "row">
								<label class = "col-sm-3">Resumen</label>
								<div class = "col-sm-9"> {{oportunidad.resumen}}</div>
								<div class="clear"></div>
							</div>
						</div>
					</section>
					<section class="perfil">
						<h3 class="title"><i class="profile"></i>Perfil del candidato</h3>
						<div class="detalle">
							<div class = "row">
								<label class = "col-sm-3">Carrera</label>
								<div class = "col-sm-9">
									{% for carrera in oportunidad.carrera.all%}
									<span class="tag">{{carrera}}</span>
									{%endfor%}
								</div>
								<div class="clear"></div>
							</div>
							<div class = "row">
								<label class = "col-sm-3">Conocimientos</label>
								<div class = "col-sm-9">
									{% for conocimiento in oportunidad.conocimiento.all%}
									<span class="tag">{{conocimiento}}</span>
									{%endfor%}
								</div>
								<div class="clear"></div>
							</div>
							<div class = "row">
								<label class = "col-sm-3">Idiomas</label>
								<div class = "col-sm-9">
									{% for idioma in oportunidad.idioma.all%}
									<span class="tag">{{idioma}}</span>
									{%endfor%}
								</div>
								<div class="clear"></div>
							</div>
							<div class = "row">
								<label class = "col-sm-3">Graduaci&oacute;n / Graduaci&oacute;n estimada</label>
								<div class = "col-sm-9">2do Semestre 2015 - 2do Semestre 2016</div>
								<div class="clear"></div>
							</div>
						</div>
					</section>
					<section class="beneficios">
						<h3 class="title"><i class="like"></i>Beneficios</h3>
						<div class="detalle">
							<p>
								{% for beneficio in oportunidad.beneficio.all%}
								<span class="tag">{{beneficio}}</span>
								{%endfor%}
							<div class="clear"></div>
						</div>
					</section>
					<section class="ubicacion">
						<h3 class="title"><i class="location"></i>Ubicaci&oacute;n</h3>
						<div class="detalle">
							<p>Calle Varham 203, Camacho, La Molina</p>
							<div class="clear"></div>
							<div class="mapa">
								<img src="../img/google-map.jpg" />
							</div>
						</div>
					</section>
				</div>
			</div>
		</div>
		<div class="clear"></div>
	</div>
</section>
<div class="popup aviso" id="resultado-postulacion">
	<div class="popup-box box">
		<div class="content" id="popup-confirm">
			<section class="header">
				<h4 class="link">CONFIRMACI&Oacute;N</h4>
			</section>
			{% if postulacion.estado == 'A'%}
				<section class="mensaje">
					<p>¿Estas seguro que deseas cancelar está postulaci&oacute;n ?!</p>
					<div class="botones-popup">
						<a class="btn-save" onclick="window.history.back();">CANCELAR</a>
						<a id= "cancelar-postulacion" class="btn-save" >ACEPTAR</a>
					</div>
				</section>
			{%else %}
			<section class="mensaje">
				<p>Tu postulaci&oacute;n ha sido registrada con &eacute;xito, ahora s&oacute;lo queda esperar por el contacto de la empresa. ¡Buena suerte!</p>
			</section>
			{%endif%}


		</div>
		<a class="close">Cerrar</a>
	</div>
</div>
{% endblock%}

{% block js %}
<script>
	$("#link-oportunidad").addClass("active");

	$('#postular').click(function(e) {
		fnCargarPopup();
		window.location = '#resultado-postulacion';
		var id = event.target.href.substr(event.target.href.lastIndexOf('#'))
        if ($(id).hasClass('popup'))
			$('body').addClass('static');
		if ($.trim($("#postular").text()) == 'POSTULAR'){
			fnPostular();
		}
	});
	$('.popup .close').click(function(e) {
		window.history.back();
		$('body').removeClass('static');
	});
	$('a').click(function(event) {

    });
	function fnPostular(){
		var id = {{oportunidad.id}};
		$.ajax({
			data : {'id':id},
			url: '{%url "estudiante-oportunidad-postular" %}',
			type: 'get',
			success: function(data){
				$("#postular").text(data[0]);
				if(data[0] == "CANCELAR") {
					$("#postular").removeClass("btn-action");
					$("#postular").addClass("btn-action-invertido");
				}
				else{
					$("#postular").removeClass("btn-action-invertido");
					$("#postular").addClass("btn-action");
				}
			}

		});
	}

	function fnCargarPopup(){

		html = '<section class="header">';
		html += '<h4 class="link">CONFIRMACI&Oacute;N</h4>';
		html += '</section>';
		html += '<section class="mensaje">';
		if($.trim($("#postular").text()) =='CANCELAR') {
			html += '<p>¿Estas seguro que deseas cancelar está postulaci&oacute;n ?!</p>';
			html += '<div class="botones-popup">';
			html += '<a class="btn-save" onclick="window.history.back();">CANCELAR</a>';
			html += '<a id="cancelar-postulacion" class="btn-save" onclick="fnCancelarPostulacion();" >ACEPTAR</a>';
			html += '</div>';

		}
		else if ($.trim($("#postular").text()) == 'POSTULAR') {
			html += '<p>Tu postulaci&oacute;n ha sido registrada con &eacute;xito, ahora s&oacute;lo queda esperar ' +
					'por el contacto de la empresa. ¡Buena suerte!</p>';
			}
		html += '</section>';
		$('#popup-confirm').html(html);
	}
	function fnCancelarPostulacion() {
		window.history.back();
		$('body').removeClass('static');
		fnPostular();
	}

</script>

{%endblock%}